<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.14.0/babel.min.js"></script>
        <script src="https://unpkg.com/redux@3.6.0/dist/redux.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/react-redux/5.0.4/react-redux.js"></script>
    </head>
    <body>
        <div id="app"></div>
        <script type="text/babel">
            //
            // REDX
            //
            const { connect } = ReactRedux;

            const reducer = (target, initialState = {}) => {
                const targetName = target.constructor.name;
                const defaultState = target.initialState || initialState;
                const actions = Object.getOwnPropertyNames(target)
                    .filter(p => target[p].__isRedXAction);
                let reducer = (state = defaultState, action) => {
                    const handler = actions.find(a => `${targetName}_${a}` === action.type);
                    if (handler !== undefined) {
                        return target[handler](state, ...action.payload);
                    }
                    return state;
                };
                reducer.reducerName = target.reducerName || targetName.replace(/reducer/i, '').toLowerCase();
                reducer.__isRedXStore = true;
                reducer.actions = actions.reduce((acc, cur) => {
                    acc[cur] = (...payload) => {
                        const action = { type: `${targetName}_${cur}`, payload };
                        return action;
                    };
                    return acc;
                }, {})
                
                return reducer;
            }

            const action = target => {
                target.__isRedXAction = true;
                return target;
            }

            const observer = (Component, ...reducers) => {
                const mapStateToProps = (state) => reducers.reduce((acc, cur) => {
                    acc[cur.reducerName] = state[cur.reducerName];
                    return acc;
                }, {});
                const mapDispatchToProps = reducers.reduce((acc, cur) => {
                    return {
                        ...acc,
                        ...cur.actions
                    };
                }, {});
                return connect(mapStateToProps, mapDispatchToProps)(Component);
            }
        </script>
        <script type="text/babel">
            //
            // Voorbeeld
            //
            const { Provider } = ReactRedux;
            const { createStore, combineReducers } = Redux;

            // REDUCER
            class PersonReducer {
                initialState = {
                    name: 'nobody',
                    age: 0
                };

                updateName = action((state, name) => ({
                    ...state,
                    name
                }));

                updateAge = action((state, age) => ({
                    ...state,
                    age
                }));

                updatePerson = action((_, name, age) => ({
                    name,
                    age
                }));
            }
            const personReducer = reducer(new PersonReducer());

            // STORE
            const reducers = combineReducers({
                person: personReducer
            });
            const store = createStore(reducers);

            // COMPONENT
            const Person = ({ person, updateName, updateAge, updatePerson }) => {
                return (
                    <div>
                        { person.name }&nbsp;<button onClick={() => {updateName('Henk')}}>Update name</button><br />
                        { person.age }&nbsp;<button onClick={() => {updateAge(38)}}>Update age</button> <br/>
                        <button onClick={() => {updatePerson('Piet', 67)}}>Update person</button>
                    </div>
                );
            };

            // CONTAINER 
            const PersonContainer = observer(Person, personReducer);

            // ROOT
            const Root = () => (
                <Provider store={store}>
                    <PersonContainer />
                </Provider>
            );
            ReactDOM.render(<Root />, document.querySelector('#app'));
        </script>
    </body>
</html>